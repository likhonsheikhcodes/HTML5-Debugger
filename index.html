<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced HTML5 Game Debugger</title>
    <meta name="description" content="Professional HTML5 Game Debugging Tool with advanced features">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-html.min.js"></script>
    <style>
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .code-preview {
            max-height: 300px;
            overflow: auto;
        }
        .floating-tools {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
        }
        .tool-button {
            @apply bg-white dark:bg-gray-800 shadow-lg rounded-full p-3 mb-2 hover:scale-110 transition-transform;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-200">
    <!-- Floating Tools -->
    <div class="floating-tools flex flex-col">
        <button class="tool-button" id="copyHtml" title="Copy HTML">
            <i class="fas fa-code"></i>
        </button>
        <button class="tool-button" id="copyCss" title="Copy CSS">
            <i class="fas fa-paint-brush"></i>
        </button>
        <button class="tool-button" id="copyAll" title="Copy All">
            <i class="fas fa-copy"></i>
        </button>
        <button class="tool-button" id="interceptToggle" title="Toggle API Intercept">
            <i class="fas fa-network-wired"></i>
        </button>
        <button class="tool-button" id="settingsBtn" title="Settings">
            <i class="fas fa-cog"></i>
        </button>
    </div>

    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-40">
            <div class="container mx-auto px-4 py-4">
                <div class="flex flex-wrap justify-between items-center">
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white flex items-center">
                        <i class="fas fa-bug mr-2"></i>
                        Game Debugger Pro
                        <span class="ml-2 text-sm bg-green-500 text-white px-2 py-1 rounded">Pro</span>
                    </h1>
                    <div class="flex space-x-3">
                        <button id="quickTest" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200">
                            <i class="fas fa-play mr-1"></i> Quick Test
                        </button>
                        <button id="darkModeToggle" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 transition-colors duration-200">
                            <i class="fas fa-moon"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8 flex-grow">
            <!-- Control Panel -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="col-span-2">
                        <div class="flex space-x-2">
                            <input type="text" id="urlInput" 
                                   class="flex-1 p-3 border rounded-lg dark:bg-gray-700 dark:text-white"
                                   placeholder="Enter game URL or use Quick Test">
                            <button id="loadUrl" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200">
                                <i class="fas fa-download mr-1"></i> Load
                            </button>
                        </div>
                    </div>
                    <div>
                        <select id="resolutionSelect" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:text-white">
                            <option value="desktop">Desktop (1920x1080)</option>
                            <option value="tablet">Tablet (1024x768)</option>
                            <option value="mobile">Mobile (375x667)</option>
                            <option value="custom">Custom Size</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Debug Tools -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <button id="inspectDOM" class="p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors duration-200">
                    <i class="fas fa-code mr-1"></i> DOM Inspector
                </button>
                <button id="networkMonitor" class="p-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200">
                    <i class="fas fa-network-wired mr-1"></i> Network
                </button>
                <button id="performanceMonitor" class="p-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors duration-200">
                    <i class="fas fa-tachometer-alt mr-1"></i> Performance
                </button>
                <button id="consoleMonitor" class="p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200">
                    <i class="fas fa-terminal mr-1"></i> Console
                </button>
            </div>

            <!-- Main Debug Area -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Game Preview -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white">
                            <i class="fas fa-gamepad mr-1"></i> Game Preview
                        </h2>
                        <div class="flex space-x-2">
                            <button id="reloadFrame" class="p-2 text-gray-600 dark:text-gray-300 hover:text-gray-800 transition-colors duration-200">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button id="fullscreenToggle" class="p-2 text-gray-600 dark:text-gray-300 hover:text-gray-800 transition-colors duration-200">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    <div id="frameWrapper" class="relative">
                        <iframe id="gameFrame" class="w-full h-[600px] border border-gray-200 dark:border-gray-700 rounded"></iframe>
                        <div id="frameOverlay" class="hidden absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                            <div class="text-white text-xl">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- Debug Output -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white">
                            <i class="fas fa-clipboard-list mr-1"></i> Debug Output
                        </h2>
                        <div class="flex space-x-2">
                            <button id="clearLogs" class="p-2 text-gray-600 dark:text-gray-300 hover:text-gray-800 transition-colors duration-200">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                            <button id="downloadLogs" class="p-2 text-gray-600 dark:text-gray-300 hover:text-gray-800 transition-colors duration-200">
                                <i class="fas fa-file-download"></i>
                            </button>
                            <button id="filterLogs" class="p-2 text-gray-600 dark:text-gray-300 hover:text-gray-800 transition-colors duration-200">
                                <i class="fas fa-filter"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Debug Tabs -->
                    <div class="mb-4">
                        <div class="flex space-x-2 border-b">
                            <button class="px-4 py-2 text-blue-600 border-b-2 border-blue-600 transition-colors duration-200" data-tab="general">General</button>
                            <button class="px-4 py-2 text-gray-600 dark:text-gray-300 transition-colors duration-200" data-tab="network">Network</button>
                            <button class="px-4 py-2 text-gray-600 dark:text-gray-300 transition-colors duration-200" data-tab="console">Console</button>
                            <button class="px-4 py-2 text-gray-600 dark:text-gray-300 transition-colors duration-200" data-tab="performance">Performance</button>
                        </div>
                    </div>

                    <div id="outputPanel" class="h-[500px] overflow-y-auto bg-gray-50 dark:bg-gray-900 p-4 rounded-lg font-mono text-sm custom-scrollbar"></div>
                </div>
            </div>

            <!-- Code Preview Modal -->
            <div id="codePreviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl m-4">
                    <div class="p-4 border-b flex justify-between items-center">
                        <h3 class="text-lg font-semibold" id="modalTitle">Code Preview</h3>
                        <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-4">
                        <pre class="code-preview custom-scrollbar"><code id="codePreview" class="language-javascript"></code></pre>
                    </div>
                    <div class="p-4 border-t flex justify-end">
                        <button id="copyCode" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                            Copy Code
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings Modal -->
            <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md m-4">
                    <div class="p-4 border-b">
                        <h3 class="text-lg font-semibold">Settings</h3>
                    </div>
                    <div class="p-4">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">Theme</label>
                                <select id="themeSelect" class="w-full p-2 border rounded">
                                    <option value="system">System</option>
                                    <option value="light">Light</option>
                                    <option value="dark">Dark</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">API Intercept Mode</label>
                                <select id="interceptMode" class="w-full p-2 border rounded">
                                    <option value="passive">Passive (Log Only)</option>
                                    <option value="active">Active (Modify Responses)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Auto-refresh Interval</label>
                                <input type="number" id="refreshInterval" class="w-full p-2 border rounded" min="0" step="1000" value="0">
                            </div>
                        </div>
                    </div>
                    <div class="p-4 border-t flex justify-end">
                        <button id="saveSettings" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                            Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Core debugging functionality
        const gameFrame = document.getElementById('gameFrame');
        const outputPanel = document.getElementById('outputPanel');
        const quickTestBtn = document.getElementById('quickTest');
        const urlInput = document.getElementById('urlInput');
        const loadUrlBtn = document.getElementById('loadUrl');
        let interceptEnabled = false;
        let settings = {
            theme: 'system',
            interceptMode: 'passive',
            refreshInterval: 0
        };

        // Enhanced logging with types and timestamps
        function log(message, type = 'info', data = null) {
            const timestamp = new Date().toISOString();
            const entry = document.createElement('div');
            entry.className = `mb-2 p-2 rounded flex items-start ${
                type === 'error' ? 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200' :
                type === 'warning' ? 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200' :
                type === 'success' ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' :
                'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200'
            }`;
            entry.dataset.type = type;

            const icon = document.createElement('i');
            icon.className = `mr-2 fas fa-${
                type === 'error' ? 'exclamation-circle' :
                type === 'warning' ? 'exclamation-triangle' :
                type === 'success' ? 'check-circle' :
                'info-circle'
            }`;

            const content = document.createElement('div');
            content.className = 'flex-1';
            content.innerHTML = `
                <span class="opacity-75 text-xs">[${timestamp}]</span><br>
                ${message}
                ${data ? `<pre class="mt-2 p-2 bg-black bg-opacity-10 rounded overflow-x-auto">${JSON.stringify(data, null, 2)}</pre>` : ''}
            `;

            entry.appendChild(icon);
            entry.appendChild(content);
            outputPanel.appendChild(entry);
            outputPanel.scrollTop = outputPanel.scrollHeight;
        }

        // Advanced Frame Monitoring
        function setupGameFrameMonitoring() {
            try {
                const frameWindow = gameFrame.contentWindow;

                // Console monitoring
                const originalConsole = {
                    log: frameWindow.console.log,
                    error: frameWindow.console.error,
                    warn: frameWindow.console.warn
                };

                frameWindow.console.log = (...args) => {
                    log(args.join(' '), 'info');
                    originalConsole.log.apply(frameWindow.console, args);
                };

                frameWindow.console.error = (...args) => {
                    log(args.join(' '), 'error');
                    originalConsole.error.apply(frameWindow.console, args);
                };

                frameWindow.console.warn = (...args) => {
                    log(args.join(' '), 'warning');
                    originalConsole.warn.apply(frameWindow.console, args);
                };

                // Network monitoring with interception
                const originalFetch = frameWindow.fetch;
                frameWindow.fetch = async (...args) => {
                    const startTime = performance.now();
                    log(`📡 Network request: ${args[0]}`, 'info');
                    
                    try {
                        let response = await originalFetch(...args);
                        const endTime = performance.now();
                        
                        if (interceptEnabled && settings.interceptMode === 'active') {
                            const clone = response.clone();
                            const data = await clone.json();
                            log('Response intercepted:', 'info', data);
                            
                            // Allow response modification
                            const modified = new Response(JSON.stringify(data), {
                                status: response.status,
                                statusText: response.statusText,
                                headers: response.headers
                            });
                            
                            response = modified;
                        }
                        
                        log(`✅ Response received (${Math.round(endTime - startTime)}ms): ${args[0]}`, 'success');
                        return response;
                    } catch (error) {
                        log(`❌ Network error: ${error.message}`, 'error');
                        throw error;
                    }
                };

                // Performance monitoring
                const observer = new PerformanceObserver((list) => {
                    list.getEntries().forEach((entry) => {
                        if (entry.entryType === 'resource') {
                            log(`📊 Resource loaded: ${entry.name} (${Math.round(entry.duration)}ms)`, 'info');
                        }
                    });
                });

                observer.observe({ entryTypes: ['resource', 'navigation'] });

                // DOM mutations monitoring
                const domObserver = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'childList') {
                            log(`🔄 DOM updated: ${mutation.target.nodeName}`, 'info');
                        }
                    });
                });

                domObserver.observe(frameWindow.document.body, {
                    childList: true,
                    subtree: true
                });

                log('🚀 Game frame monitoring initialized', 'success');
            } catch (error) {
                log(`❌ Error setting up frame monitoring: ${error.message}`, 'error');
            }
        }

        // Copy functionality
        function setupCopyButtons() {
            const copyHtml = document.getElementById('copyHtml');
            const copyCss = document.getElementById('copyCss');
            const copyAll = document.getElementById('copyAll');
            
            copyHtml.addEventListener('click', async () => {
                try {
                    const html = gameFrame.contentDocument.documentElement.outerHTML;
                    await navigator.clipboard.writeText(html);
                    log('📋 HTML copied to clipboard', 'success');
                } catch (error) {
                    log('❌ Failed to copy HTML', 'error');
                }
            });
            
            copyCss.addEventListener('click', async () => {
                try {
                    const styles = Array.from(gameFrame.contentDocument.styleSheets)
                        .map(sheet => {
                            try {
                                return Array.from(sheet.cssRules)
                                    .map(rule => rule.cssText)
                                    .join('\n');
                            } catch (e) {
                                return '';
                            }
                        })
                        .join('\n');
                    await navigator.clipboard.writeText(styles);
                    log('📋 CSS copied to clipboard', 'success');
                } catch (error) {
                    log('❌ Failed to copy CSS', 'error');
                }
            });
            
            copyAll.addEventListener('click', async () => {
                try {
                    const html = gameFrame.contentDocument.documentElement.outerHTML;
                    const styles = Array.from(gameFrame.contentDocument.styleSheets)
                        .map(sheet => {
                            try {
                                return Array.from(sheet.cssRules)
                                    .map(rule => rule.cssText)
                                    .join('\n');
                            } catch (e) {
                                return '';
                            }
                        })
                        .join('\n');
                    await navigator.clipboard.writeText(`${html}\n\n<style>\n${styles}\n</style>`);
                    log('📋 Full page content copied to clipboard', 'success');
                } catch (error) {
                    log('❌ Failed to copy full page content', 'error');
                }
            });
        }

        // Settings functionality
        function setupSettings() {
            const settingsBtn = document.getElementById('settingsBtn');
            const settingsModal = document.getElementById('settingsModal');
            const saveSettings = document.getElementById('saveSettings');
            const themeSelect = document.getElementById('themeSelect');
            const interceptMode = document.getElementById('interceptMode');
            const refreshInterval = document.getElementById('refreshInterval');
            
            settingsBtn.addEventListener('click', () => {
                settingsModal.style.display = 'flex';
                themeSelect.value = settings.theme;
                interceptMode.value = settings.interceptMode;
                refreshInterval.value = settings.refreshInterval;
            });
            
            saveSettings.addEventListener('click', () => {
                settings = {
                    theme: themeSelect.value,
                    interceptMode: interceptMode.value,
                    refreshInterval: parseInt(refreshInterval.value)
                };
                settingsModal.style.display = 'none';
                log('⚙️ Settings updated', 'success');
                
                // Apply settings
                applyTheme(settings.theme);
                if (settings.refreshInterval > 0) {
                    startAutoRefresh();
                }
            });
            
            document.addEventListener('click', (e) => {
                if (e.target === settingsModal) {
                    settingsModal.style.display = 'none';
                }
            });
        }

        // Theme functionality
        function applyTheme(theme) {
            if (theme === 'system') {
                const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.documentElement.classList.toggle('dark', isDark);
            } else {
                document.documentElement.classList.toggle('dark', theme === 'dark');
            }
        }

        // Auto-refresh functionality
        let refreshInterval;
        function startAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            if (settings.refreshInterval > 0) {
                refreshInterval = setInterval(() => {
                    gameFrame.contentWindow.location.reload();
                    log('🔄 Auto-refreshed game frame', 'info');
                }, settings.refreshInterval);
            }
        }

        // Initialize
        function init() {
            setupCopyButtons();
            setupSettings();
            
            // API Intercept toggle
            const interceptToggle = document.getElementById('interceptToggle');
            interceptToggle.addEventListener('click', () => {
                interceptEnabled = !interceptEnabled;
                interceptToggle.classList.toggle('bg-blue-600');
                interceptToggle.classList.toggle('text-white');
                log(`🔄 API Interception ${interceptEnabled ? 'enabled' : 'disabled'}`, 'info');
            });
            
            // Quick Test
            quickTestBtn.addEventListener('click', () => {
                const testUrl = "https://m.pgsoft-games.com/100/index.html?l=en&ot=ca7094186b309ee149c55c8822e7ecf2&btt=2&from=https://clashofslots.com/&language=en-EN&__refer=m.pg-redirect.net&or=static.pgsoft-games.com";
                urlInput.value = testUrl;
                startDebugging(testUrl);
            });
            
            // Load URL
            loadUrlBtn.addEventListener('click', () => {
                const url = urlInput.value.trim();
                if (url) {
                    startDebugging(url);
                } else {
                    log('Please enter a valid URL', 'error');
                }
            });
            
            // Resolution handler
            const resolutionSelect = document.getElementById('resolutionSelect');
            resolutionSelect.addEventListener('change', (e) => {
                const sizes = {
                    desktop: { width: '1920px', height: '1080px' },
                    tablet: { width: '1024px', height: '768px' },
                    mobile: { width: '375px', height: '667px' },
                    custom: { width: prompt('Enter width (px):', '800') + 'px', height: prompt('Enter height (px):', '600') + 'px' }
                };
                
                const size = sizes[e.target.value];
                if (size) {
                    gameFrame.style.width = size.width;
                    gameFrame.style.height = size.height;
                    log(`📱 Resolution changed to ${e.target.value}`, 'info');
                }
            });
            
            // Initialize theme
            applyTheme(settings.theme);
            
            log('🔧 Game Debugger Pro initialized', 'success');
        }

        // Start debugging
        function startDebugging(url) {
            const frameOverlay = document.getElementById('frameOverlay');
            frameOverlay.classList.remove('hidden');
            
            gameFrame.src = url;
            log('Starting debugging...', 'info');
            setupGameFrameMonitoring();
        }

        // Frame load handler
        gameFrame.addEventListener('load', () => {
            const frameOverlay = document.getElementById('frameOverlay');
            frameOverlay.classList.add('hidden');
            log('🎮 Game frame loaded successfully', 'success');
        });

        // Initialize everything
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

